---
import { Image } from "astro:assets";
import imageElefante from "@assets/elefante.webp";
import imageCamino from "@assets/camino.webp";
import imageValle from "@assets/valle.webp";
import videoFaedo from "@assets/faedo.mp4";
import videoMarmitas from "@assets/marmitas.mp4";
import videoPozo from "@assets/pozo.mp4";
import videoCaminando from "@assets/caminando.mp4";
import videoPuente from "@assets/puente.mp4";
---

<section class="py-20 px-4">
  <div class="max-w-7xl mx-auto">
    <header>
      <h2 class="text-emerald-800 text-center text-5xl max-w-3xl mx-auto">
        La magia se esconde en cada rinc칩n de este emblem치tico bosque
      </h2>
    </header>
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6">
      <div class="media-item opacity-0 translate-y-12" data-delay="400">
        <div
          class="relative aspect-[9/16] rounded-lg overflow-hidden bg-gray-900"
        >
          <video
            class="absolute inset-0 w-full h-full object-cover"
            playsinline
            autoplay
            muted
            loop
          >
            <source src={videoFaedo} type="video/mp4" />
          </video>
          <Image
            src={imageElefante}
            alt="Bosque del Faedo de Ci침era"
            class="absolute inset-0 w-full h-full object-cover"
            widths={[380]}
            sizes="380px"
            quality={65}
            loading="lazy"
          />
        </div>
      </div>

      <div class="media-item opacity-0 translate-y-12" data-delay="200">
        <div
          class="relative aspect-[9/16] rounded-lg overflow-hidden bg-gray-900"
        >
          <video
            class="absolute inset-0 w-full h-full object-cover"
            playsinline
            autoplay
            muted
            loop
          >
            <source src={videoPuente} type="video/mp4" />
          </video>
          <Image
            src={imageValle}
            alt="Valle de Ci침era"
            class="absolute inset-0 w-full h-full object-cover"
            widths={[380]}
            sizes="380px"
            quality={65}
            loading="lazy"
          />
        </div>
      </div>

      <div class="media-item opacity-0 translate-y-12" data-delay="0">
        <div
          class="relative aspect-[9/16] rounded-lg overflow-hidden bg-gray-900"
        >
          <video
            class="absolute inset-0 w-full h-full object-cover"
            playsinline
            autoplay
            muted
            loop
          >
            <source src={videoMarmitas} type="video/mp4" />
          </video>
          <Image
            src={imageCamino}
            alt="Camino del Faedo"
            class="absolute inset-0 w-full h-full object-cover"
            widths={[380]}
            sizes="380px"
            quality={65}
            loading="lazy"
          />
        </div>
      </div>

      <div class="media-item opacity-0 translate-y-12" data-delay="200">
        <div
          class="relative aspect-[9/16] rounded-lg overflow-hidden bg-gray-900"
        >
          <video
            class="absolute inset-0 w-full h-full object-cover"
            playsinline
            autoplay
            muted
            loop
          >
            <source src={videoCaminando} type="video/mp4" />
          </video>
          <Image
            src={imageCamino}
            alt="Camino del Faedo"
            class="absolute inset-0 w-full h-full object-cover"
            widths={[380]}
            sizes="380px"
            quality={65}
            loading="lazy"
          />
        </div>
      </div>

      <div class="media-item opacity-0 translate-y-12" data-delay="400">
        <div
          class="relative aspect-[9/16] rounded-lg overflow-hidden bg-gray-900"
        >
          <video
            class="absolute inset-0 w-full h-full object-cover"
            playsinline
            autoplay
            muted
            loop
          >
            <source src={videoPozo} type="video/mp4" />
          </video>
          <Image
            src={imageCamino}
            alt="Camino del Faedo"
            class="absolute inset-0 w-full h-full object-cover"
            widths={[380]}
            sizes="380px"
            quality={65}
            loading="lazy"
          />
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .media-item {
    transition:
      opacity 0.7s ease-out,
      transform 0.7s ease-out;
  }

  .media-item.active {
    opacity: 1;
    transform: translateY(0);
  }

  video {
    z-index: 10;
  }
</style>

<script>
  const observerOptions = {
    threshold: 0.15,
    rootMargin: "0px 0px -50px 0px",
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const element = entry.target as HTMLElement;
        const delay = parseInt(element.getAttribute("data-delay") || "0");

        setTimeout(() => {
          element.classList.add("active");
        }, delay);

        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll(".media-item").forEach((item) => {
    observer.observe(item);
  });
</script>
